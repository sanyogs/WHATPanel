<?php 
/*
 * This file is part of WHATPANEL.
 *
 * @package     WHAT PANEL â€“ Web Hosting Access Terminal Panel.
 * @copyright   2023-2024 Version Next Technologies and MadPopo. All rights reserved.
 * @license     BSL; see LICENSE.txt
 * @link        https://www.version-next.com
 */

use App\Libraries\AppLib;
use App\Models\Client;
use App\Models\User;

use App\Helpers\custom_name_helper;

$clientModel = new Client();

$custom_name = new custom_name_helper();

$i = Client::view_by_id($company);

$cur = Client::client_currency($i->co_id);
$due = $clientModel->due_amount($i->co_id);
?>
<?= $this->extend('layouts/users') ?>

<?= $this->section('content') ?>
<section id="manage-client-section">
  <div class="container-fluid px-0">
    <div class="mc-row">
      <div class="col-lg-3 col-12">
        <div class="mcLeftBlock">
          <div class="clientWrapper">
            <h2>Client</h2>
            <table class="client-table">
              <thead>
                <tr>
                  <th colspan="2"><?= $i->company_name ?></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Paid- This Month</td>
                  <td><?= AppLib::format_currency($clientModel->month_amount(date('Y'), date('m'), $i->co_id), 'default_currency'); ?></td>
                </tr>
                <tr>
                  <td>Balance Due</td>
                  <td><?= AppLib::format_currency($due, 'default_currency'); ?></td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td>Total Amount</td>
                  <td><?= AppLib::format_currency(Client::amount_paid($i->co_id), 'default_currency') ?></td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="detailsWrapper">
            <h2>Details</h2>
            <div class="detailsBlock">
              <h2><?= ($i->primary_contact) ? User::displayName($i->primary_contact) : ''; ?></h2>
              <div class="infoDetails">
                <div class="infoBlocks">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                      <path d="M1.06733 1.05988L1.67973 0.52921C2.38545 -0.176403 3.5286 -0.176403 4.23432 0.52921C4.25182 0.546704 5.33081 1.9521 5.33081 1.9521C5.99571 2.65188 5.99571 3.75404 5.33081 4.44799L4.65425 5.29939C5.50578 7.22962 6.82974 8.5592 8.69611 9.35229L9.54764 8.67C10.2417 7.99937 11.3498 7.99937 12.0439 8.67C12.0439 8.67 13.4495 9.74883 13.467 9.76632C14.1727 10.4719 14.1727 11.6149 13.4962 12.2914L12.9129 12.962C12.2422 13.6326 11.3382 14 10.3583 14C5.90239 14 0 8.09268 0 3.64324C0 2.66937 0.367441 1.75966 1.06733 1.06571V1.05988ZM10.3583 12.8279C11.0232 12.8279 11.6356 12.5829 12.0556 12.1572L12.6388 11.4866C12.8779 11.2475 12.8896 10.8568 12.6621 10.6061C12.6621 10.6061 11.2682 9.53306 11.2507 9.51557C11.0116 9.27647 10.5916 9.27647 10.3467 9.51557C10.3292 9.53306 9.15686 10.4719 9.15686 10.4719C8.99356 10.6002 8.77776 10.6352 8.58529 10.5594C6.17068 9.63803 4.43845 7.9119 3.44111 5.42185C3.36529 5.22941 3.39445 5.00781 3.5286 4.8387C3.5286 4.8387 4.46762 3.66073 4.47928 3.64907C4.73007 3.39831 4.73007 2.99594 4.47928 2.74518C4.46178 2.72769 3.38862 1.33396 3.38862 1.33396C3.13783 1.10653 2.74706 1.11236 2.47877 1.38061L1.86637 1.91128C1.41727 2.3603 1.16648 2.97261 1.16648 3.6374C1.16648 7.69614 6.86473 12.8279 10.3583 12.8279Z" fill="#172F78" />
                    </svg>
                  </span>
                  <p><?= $i->company_phone ?></p>
                </div>
                <div class="infoBlocks">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                      <path d="M6.41667 7.875C6.41667 7.39083 6.8075 7 7.29167 7C7.77583 7 8.16667 7.39083 8.16667 7.875C8.16667 8.35917 7.77583 8.75 7.29167 8.75C6.8075 8.75 6.41667 8.35917 6.41667 7.875ZM7.29167 9.91667C6.8075 9.91667 6.41667 10.3075 6.41667 10.7917C6.41667 11.2758 6.8075 11.6667 7.29167 11.6667C7.77583 11.6667 8.16667 11.2758 8.16667 10.7917C8.16667 10.3075 7.77583 9.91667 7.29167 9.91667ZM10.2083 8.75C10.6925 8.75 11.0833 8.35917 11.0833 7.875C11.0833 7.39083 10.6925 7 10.2083 7C9.72417 7 9.33333 7.39083 9.33333 7.875C9.33333 8.35917 9.72417 8.75 10.2083 8.75ZM10.2083 11.6667C10.6925 11.6667 11.0833 11.2758 11.0833 10.7917C11.0833 10.3075 10.6925 9.91667 10.2083 9.91667C9.72417 9.91667 9.33333 10.3075 9.33333 10.7917C9.33333 11.2758 9.72417 11.6667 10.2083 11.6667ZM14 3.64V11.0833C14 12.6933 12.6933 14 11.0833 14H2.33333C1.04417 14 0 12.9558 0 11.6667V4.66667C0 3.3775 1.04417 2.33333 2.33333 2.33333C3.6225 2.33333 4.66667 3.3775 4.66667 4.66667H5.83333V2.33333C5.83333 1.04417 6.8775 0 8.16667 0H10.36C10.9842 0 11.5675 0.245 12.0108 0.6825L13.3175 1.98917C13.7492 2.42083 14 3.02167 14 3.64ZM3.5 4.66667C3.5 4.025 2.975 3.5 2.33333 3.5C1.69167 3.5 1.16667 4.025 1.16667 4.66667V11.6667C1.16667 12.3083 1.69167 12.8333 2.33333 12.8333C2.975 12.8333 3.5 12.3083 3.5 11.6667V4.66667ZM7 4.66667H12.8333V3.64C12.8333 3.59333 12.8333 3.54667 12.8217 3.5H11.6667C11.025 3.5 10.5 2.975 10.5 2.33333V1.17833C10.4533 1.17833 10.4067 1.16667 10.36 1.16667H8.16667C7.525 1.16667 7 1.69167 7 2.33333V4.66667ZM12.8333 5.83333H4.66667V11.6667C4.66667 12.0925 4.55 12.4892 4.35167 12.8333H11.0833C12.0458 12.8333 12.8333 12.0458 12.8333 11.0833V5.83333Z" fill="#172F78" />
                    </svg>
                  </span>
                  <p><?= $i->company_fax ?></p>
                </div>
                <div class="infoBlocks">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16" fill="none">
                      <path d="M8 11C8.552 11 9 11.448 9 12C9 12.552 8.552 13 8 13H6C5.448 13 5 12.552 5 12C5 11.448 5.448 11 6 11H8Z" fill="#172F78" />
                      <rect x="0.6" y="0.6" width="12.8" height="14.8" rx="2.4" stroke="#172F78" stroke-width="1.2" />
                    </svg>
                  </span>
                  <p><?= $i->company_mobile ?></p>
                </div>
                <div class="infoBlocks">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                      <g clip-path="url(#clip0_1874_1133)">
                        <path d="M6.99963 0C5.14373 0.0020073 3.36442 0.74015 2.0521 2.05247C0.739783 3.36479 0.0016409 5.1441 -0.000366397 7C-0.0738664 12.5842 6.50905 16.0002 11.0246 12.7266C11.0895 12.6834 11.1451 12.6277 11.1881 12.5627C11.2311 12.4977 11.2606 12.4247 11.275 12.3481C11.2893 12.2715 11.2881 12.1928 11.2715 12.1167C11.2549 12.0405 11.2232 11.9685 11.1783 11.9048C11.1334 11.8411 11.0762 11.787 11.01 11.7458C10.9439 11.7046 10.8702 11.677 10.7932 11.6648C10.7162 11.6526 10.6376 11.6559 10.5619 11.6745C10.4863 11.6932 10.4151 11.7268 10.3526 11.7734C6.5913 14.4993 1.10797 11.6538 1.1663 7C1.48655 -0.7385 12.5139 -0.73675 12.833 7V8.16667C12.833 8.47608 12.7101 8.77283 12.4913 8.99162C12.2725 9.21042 11.9757 9.33333 11.6663 9.33333C11.3569 9.33333 11.0601 9.21042 10.8413 8.99162C10.6226 8.77283 10.4996 8.47608 10.4996 8.16667V7C10.3526 2.37475 3.64605 2.37533 3.49963 7C3.50642 7.70933 3.72798 8.39996 4.13511 8.98086C4.54223 9.56176 5.11582 10.0057 5.78026 10.2541C6.44471 10.5025 7.16883 10.5437 7.85719 10.3724C8.54555 10.201 9.16584 9.82515 9.6363 9.29425C9.88935 9.74086 10.2826 10.0916 10.7552 10.292C11.2277 10.4925 11.7532 10.5315 12.2502 10.4031C12.7472 10.2747 13.188 9.98593 13.5043 9.58161C13.8205 9.17729 13.9946 8.67997 13.9996 8.16667V7C13.9976 5.1441 13.2595 3.36479 11.9472 2.05247C10.6348 0.74015 8.85553 0.0020073 6.99963 0ZM6.99963 9.33333C6.3808 9.33333 5.7873 9.0875 5.34972 8.64991C4.91213 8.21233 4.6663 7.61884 4.6663 7C4.6663 6.38116 4.91213 5.78767 5.34972 5.35008C5.7873 4.9125 6.3808 4.66667 6.99963 4.66667C7.61847 4.66667 8.21197 4.9125 8.64955 5.35008C9.08714 5.78767 9.33297 6.38116 9.33297 7C9.33297 7.61884 9.08714 8.21233 8.64955 8.64991C8.21197 9.0875 7.61847 9.33333 6.99963 9.33333Z" fill="#172F78" />
                      </g>
                      <defs>
                        <clipPath id="clip0_1874_1133">
                          <rect width="14" height="14" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </span>
                  <p><?= $i->company_email ?></p>
                </div>
              </div>
              <div class="addressDetails">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <g clip-path="url(#clip0_1874_1135)">
                      <path d="M5.57258 8.39834C5.96633 8.78335 6.48317 8.97585 7 8.97585C7.51683 8.97585 8.03367 8.78335 8.42742 8.39834L9.88692 6.97035C10.6581 6.19918 11.0833 5.17368 11.0833 4.08284C11.0833 2.99201 10.6581 1.96709 9.88692 1.19534C9.11633 0.424178 8.09083 -0.000488281 7 -0.000488281C5.90917 -0.000488281 4.88367 0.424178 4.1125 1.19534C2.52058 2.78726 2.52058 5.37785 4.11717 6.97443L5.57258 8.39776V8.39834ZM4.93733 2.02076C5.488 1.47009 6.22067 1.16676 7 1.16676C7.77933 1.16676 8.51142 1.47009 9.06208 2.02076C9.61275 2.57143 9.91667 3.3041 9.91667 4.08343C9.91667 4.86276 9.61275 5.59484 9.06675 6.14143L7.61192 7.56476C7.27475 7.89376 6.72525 7.89376 6.38808 7.56476L4.93733 6.1461C3.80042 5.0086 3.80042 3.15768 4.93733 2.02076ZM5.25 4.07759C5.25 3.11101 6.03342 2.32759 7 2.32759C7.96658 2.32759 8.75 3.11101 8.75 4.07759C8.75 5.04418 7.96658 5.82759 7 5.82759C6.03342 5.82759 5.25 5.04418 5.25 4.07759ZM14 9.78084C14 9.98618 13.8921 10.1758 13.7171 10.2808L7.96483 13.7323C7.66733 13.9108 7.33367 14.0001 7.00058 14.0001C6.6675 14.0001 6.33325 13.9108 6.03633 13.7323L0.282917 10.2813C0.107333 10.1758 0 9.98618 0 9.78143C0 9.57668 0.107917 9.38651 0.282917 9.28151L2.74983 7.80159C3.02692 7.63534 3.38508 7.72518 3.55017 8.00168C3.71583 8.27818 3.62658 8.63634 3.35008 8.80201L1.71675 9.78201L6.636 12.7337C6.86058 12.8678 7.13942 12.8678 7.364 12.7337L12.2832 9.78201L10.6499 8.80201C10.3734 8.63634 10.2842 8.27818 10.4498 8.00168C10.6155 7.72518 10.9731 7.63534 11.2502 7.80159L13.7171 9.28151C13.8927 9.3871 14 9.57609 14 9.78084Z" fill="#172F78" />
                    </g>
                    <defs>
                      <clipPath id="clip0_1874_1135">
                        <rect width="14" height="14" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </span>
                <p>
                  <?= nl2br($i->company_address) ?>,
                  <?= $i->city ?>, <?= $i->zip ?>, <?= $i->state ?>, <?= $i->country ?>
                </p>
              </div>
              <div class="loremDetails">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M11.0833 0H2.91667C1.30842 0 0 1.30842 0 2.91667V11.0833C0 12.6916 1.30842 14 2.91667 14H9.71017C10.4609 14 11.1667 13.7078 11.6976 13.1769L13.1769 11.6976C13.7002 11.1749 14 10.4498 14 9.71017V2.91667C14 1.30842 12.6916 0 11.0833 0ZM1.16667 11.0833V2.91667C1.16667 1.95183 1.95183 1.16667 2.91667 1.16667H11.0833C12.0482 1.16667 12.8333 1.95183 12.8333 2.91667V8.75H10.5C9.53517 8.75 8.75 9.53517 8.75 10.5V12.8333H2.91667C1.95183 12.8333 1.16667 12.0482 1.16667 11.0833ZM10.8727 12.3521C10.6114 12.6134 10.2778 12.775 9.91667 12.8199V10.5C9.91667 10.178 10.1786 9.91667 10.5 9.91667H12.8193C12.7732 10.2754 12.6087 10.6155 12.3515 10.8727L10.8727 12.3521ZM2.91667 3.79167C2.91667 3.30867 3.30867 2.91667 3.79167 2.91667C4.27467 2.91667 4.66667 3.30867 4.66667 3.79167C4.66667 4.27467 4.27467 4.66667 3.79167 4.66667C3.30867 4.66667 2.91667 4.27467 2.91667 3.79167ZM4.66667 7C4.66667 7.483 4.27467 7.875 3.79167 7.875C3.30867 7.875 2.91667 7.483 2.91667 7C2.91667 6.517 3.30867 6.125 3.79167 6.125C4.27467 6.125 4.66667 6.517 4.66667 7ZM4.66667 10.2083C4.66667 10.6913 4.27467 11.0833 3.79167 11.0833C3.30867 11.0833 2.91667 10.6913 2.91667 10.2083C2.91667 9.72533 3.30867 9.33333 3.79167 9.33333C4.27467 9.33333 4.66667 9.72533 4.66667 10.2083Z" fill="#172F78" />
                  </svg>
                </span>
                <p>
                  <?= $i->notes; ?>
                </p>
              </div>
              <a href="<?= base_url() ?>companies/update/<?= $i->co_id ?>" data-toggle="ajaxModal">
                <div class="editButton">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M8 0C3.58867 0 0 3.58867 0 8C0 12.4113 3.58867 16 8 16C12.4113 16 16 12.4113 16 8C16 3.58867 12.4113 0 8 0ZM8 14.6667C4.324 14.6667 1.33333 11.676 1.33333 8C1.33333 4.324 4.324 1.33333 8 1.33333C11.676 1.33333 14.6667 4.324 14.6667 8C14.6667 11.676 11.676 14.6667 8 14.6667ZM8.91933 4.25267L4.97667 8.19533C4.34733 8.82467 4 9.662 4 10.552V11.3333C4 11.702 4.298 12 4.66667 12H5.448C6.338 12 7.17533 11.6527 7.80467 11.0233L11.7473 7.08067C12.5273 6.30067 12.5273 5.03267 11.7473 4.25267C10.9673 3.47267 9.69933 3.47267 8.91933 4.25267ZM6.862 10.0807C6.48933 10.4533 5.974 10.6667 5.448 10.6667H5.33333V10.552C5.33333 10.026 5.54667 9.51067 5.91933 9.138L8.224 6.83333L9.16667 7.776L6.862 10.0807ZM10.8047 6.138L10.1093 6.83333L9.16667 5.89067L9.862 5.19533C10.1227 4.93467 10.544 4.93467 10.8047 5.19533C11.0653 5.456 11.0647 5.878 10.8047 6.138Z" fill="white" />
                    </svg>
                  </span>
                  <p>Edit Details</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-9 col-12">
        <div class="nav-tabs-custom">
          <ul class="nav nav-tabs">

            <li class="common-p p-3 <?= ($tab == 'accounts') ? 'active' : ''; ?>">
              <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/accounts"><i class="fa fa-server"></i>
                <?= lang('hd_lang.hosting_accounts') ?>
              </a>
            </li>

            <li class="common-p p-3 <?= ($tab == 'domains') ? 'active' : ''; ?>">
              <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/domains"><i class="fa fa-globe"></i>
                <?= lang('hd_lang.domains') ?>
              </a>
            </li>

            <li class="common-p p-3 <?= ($tab == 'contacts') ? 'active' : ''; ?>">
              <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/contacts"><i class="fa fa-user"></i>
                <?= lang('hd_lang.contacts') ?>
              </a>
            </li>
            <?php if (User::is_admin() || User::perm_allowed(User::get_id(), 'view_all_invoices')) { ?>
              <li class="common-p p-3 <?= ($tab == 'invoices') ? 'active' : ''; ?>">
                <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/invoices"><i class="fa fa-money"></i>
                  <?= lang('hd_lang.invoices') ?>
                </a>
              </li>
            <?php } ?>
            <?php if (User::is_admin() || User::perm_allowed(User::get_id(), 'view_all_payments')) { ?>

              <li class="common-p p-3 <?= ($tab == 'payments') ? 'active' : ''; ?>">
                <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/payments"><i class="fa fa-credit-card"></i>
                  <?= lang('hd_lang.payments') ?>
                </a>
              </li>
            <?php } ?>

            <li class="common-p p-3 <?= ($tab == 'files') ? 'active' : ''; ?>">
              <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/files"><i class="fa fa-file-o"></i>
                <?= lang('hd_lang.files') ?>
              </a>
            </li>

            <li class="common-p p-3 <?= ($tab == 'email') ? 'active' : ''; ?>">
              <a href="<?= base_url() ?>companies/view/<?= $i->co_id ?>/email"><i class="fa fa-envelope"></i>
                <?= lang('hd_lang.send_email') ?>
              </a>
            </li>
          </ul>
          <div class="tab-content ">
            <div class="active tab-pane">

              <?php $data = array('i' => $i, 'cur' => $cur, 'due' => $due); ?>
              <?php echo view('modules/companies/tab/view_' . $tab, $data); ?>


            </div>
            <!-- /.tab-pane -->
          </div>
          <!-- /.tab-content -->
        </div>
        <!-- /.nav-tabs-custom -->
      </div>
    </div>
  </div>
</section>
<?= $this->endSection() ?>
<!-- /.row -->